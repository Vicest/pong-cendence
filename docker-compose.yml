version: "3.5"
services:
  postgres:
    container_name: postgres-container
    env_file: .env
    image: postgres:alpine
    ports:
      - ${POSTGRES_PORT}:${POSTGRES_PORT}
    expose:
      - ${POSTGRES_PORT}
    networks:
      - pong-network
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
      - ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    deploy:
      resources:
        limits:
          cpus: "0.30"
          memory: 50M
        reservations:
          memory: 50M
    restart: always

  backend:
    build: ./backend
    container_name: backend-container
    hostname: backend
    image: "backend-image"
    env_file: .env
    depends_on:
      - postgres
    ports:
      - ${BACKEND_PORT}:${BACKEND_PORT}
      - ${BACKEND_WEBSOCKETS_PORT}:${BACKEND_WEBSOCKETS_PORT}
    volumes:
      - ./backend:/app
    networks:
      - pong-network
    restart: always

  front:
    build: ./frontend
    container_name: frontend-container
    hostname: frontend
    image: "frontend-image"
    env_file: .env
    depends_on:
      - postgres
    ports:
      - ${FRONTEND_PORT}:${FRONTEND_PORT}
    volumes:
      - ./frontend:/usr/src/frontend
    environment:
      - PUBLIC_BACKEND_PORT=${BACKEND_PORT}
      - PUBLIC_BACKEND_BASE=${BACKEND_BASE}
    networks:
      - pong-network
    restart: always

  adminer:
    image: adminer
    container_name: adminer
    ports:
      - ${ADMINER_PORT}:8080
    environment:
      - ADMINER_DEFAULT_SERVER=postgres
    depends_on:
      - postgres
    networks:
      - pong-network
    deploy:
      resources:
        limits:
          cpus: "0.10"
          memory: 50M
        reservations:
          memory: 50M
    restart: always

networks:
  pong-network:
    name: pong-network
    driver: bridge
